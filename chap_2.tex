\chapter{Teoria alla base del problema ed algoritmi per la risoluzione}
\label{chap:teoria}
\section{Misura del grado di controversia}
Prima di dare una definizione formale del \textit{random-walk controversy score}, elenchiamo ed illustriamo i passi necessari per calcolarlo.
\begin{enumerate}
\item Fissato il \textit{topic t} per il quale si vuole quantificare il grado di controversia, è possibile descrivere la discussione mediante l'\textit{endorsement graph G(V,E)}. Nell'ambiente di \textit{Twitter}, il \textit{topic t} è identificato da un \textit{hashtag} (e.g.\textit{\#hashtag}) ed i nodi del grafo rappresentano gli utenti che hanno preso parte alla discussione utilizzando almeno una volta tale \textit{hashtag} nei loro \textit{tweets}; gli archi del grafo identificano i \textit{retweets} tra gli utenti, che esprimono relazioni di condivisione di opinione riguardo il \textit{topic}.
\item Ipotizzando che il \textit{topic t} sia controverso, è possibile partizionare i nodi del grafo \textit{G(V,E)} in due insiemi \textit{X},\textit{Y} ben separati tra loro (i.e. vi sono pochi archi che li interconnettono). Tali insiemi quindi soddisfano le seguenti proprietà:
\begin{enumerate}
\item $\textit{X}\cup\textit{Y} = \textit{V}$;
\item $\textit{X}\cap\textit{Y} = \emptyset$.
\end{enumerate}
Gli insiemi \textit{X} ed \textit{Y} rappresentano i due lati della controversia (i.e. le \textit{echo-chambers}).
\\Per identificare le \textit{echo-chambers}, nell'implementazione proposta è stato utilizzato l'algoritmo di \textit{graph-partitioning} di \textit{Girvan-Newman}\cite{girvan:paper}. Tale algoritmo agisce rimuovendo progressivamente archi dal grafo originario: l'esecuzione viene arrestata quando la rimozione degli archi ha portato ad individuare due comunità distinte che non comunicano (i.e. non sono collegate da nessun arco). La metrica utilizzata da \textit{Girvan-Newman} per identificare l'arco da rimuovere ad ogni passo è la così detta \textit{edge-betweenness centrality}: dato un arco \textit{e}, essa è definita come \textit{il numero di cammini di costo minimo tra coppie di nodi del grafo che passano attraverso l'arco e}. Nel caso in cui vi sia più di un percorso di costo minimo tra una coppia di nodi, a ciascun percorso viene assegnato uguale peso in modo tale che il peso totale di tutti i percorsi sia uguale all'unità. Di seguito la formula che definisce questa metrica di centralità:
\\
\begin{equation}b(e) = \sum_{\substack{
   s \neq t
  }} 
 \cfrac{\sigma\textsubscript{st}(e)}{\sigma\textsubscript{st}}
\end{equation}
\\ 
Dove \textit{$\sigma\textsubscript{st}$} è il numero totale di percorsi di costo minimo dal nodo \textit{s} al nodo \textit{t} e \textit{$\sigma\textsubscript{st}(e)$} è il numero di tali percorsi che passano attraverso l'arco \textit{e}. 
\\L'intuizione è: se la struttura del grafo è caratterizzata da due comunità di nodi connesse tra loro da pochissimi archi, allora tutti i percorsi tra queste due comunità dovranno passare attraverso questi archi. Ne consegue che quest'ultimi saranno caratterizzati da un'alta \textit{betweenness centrality}. Sfruttando la peculiarità di tali archi, l'algoritmo di \textit{Girvan-Newman} si rivela un ottimo metodo per rilevare le \textit{echo-chambers}.
\item A questo punto è possibile procedere con la definizione del \textit{random-walk controversy score}. L'\textit{RWC} è definito come \textit{la differenza della probabilità che un random walk che parte da una echo-chamber all'equilibrio vi permanga e la probabilità che invece tale random walk all'equilibrio finisca nell'echo-chamber opposta}. Tale misura viene calcolata mediante l'utilizzo di due esecuzioni dell'algoritmo di \textit{PageRank} personalizzato, le quali non sono altro che due \textit{random walks} particolari.\\
\textit{PageRank} è un algoritmo di analisi che assegna un peso numerico a ciascun nodo di un grafo diretto, con lo scopo di quantificare la sua importanza relativa. Le applicazioni più frequenti di \textit{PageRank} riguardano l'ambito del \textit{World Wide Web}, in cui i grafi hanno come nodi le pagine \textit{web} e come archi i collegamenti ipertestuali. Ciò non toglie che \textit{PageRank} sia uno strumento molto potente anche nell'ambito delle reti sociali, poiché riesce a quantificare l'importanza di utente nell'ambito di una discussione: tale importanza misura il suo grado di popolarità e di rilevanza.
\\Per il calcolo dell'\textit{RWC} vengono utilizzate due esecuzioni distinte dell'algoritmo di \textit{PageRank}, indicate con \textit{page\textsubscript{x} e page\textsubscript{y}}, ognuna delle quali opera sul \textit{retweet graph} corrispondente al \textit{topic t} in input ma inizia il suo \textit{random-walk} partendo, rispettivamente, da uno dei nodi della \textit{comunità X} e da uno dei nodi della \textit{comunità Y} (\textit{comunità = echo-chamber}). Inoltre, \textit{page\textsubscript{x} e page\textsubscript{y}} ad ogni passo possono decidere di continuare il \textit{random-walk} (potendo sceglie con uguale probabilità uno degli archi in uscita dal nodo in cui si trovano attualmente) o di ricominciare il proprio cammino (\textit{restart}), tornando, rispettivamente, in uno dei nodi della \textit{comunità X} ed in uno dei nodi della \textit{comunità Y}: la seconda scelta viene compiuta con una probabilità detta di \textit{restart} e, chiaramente, la prima con una probabilità che ne è il complementare (i.e. la somma delle probabilità deve restituire \textit{1}).
\\Scendendo più nel dettaglio, siano:
\begin{itemize}
\item \textit{P} la \textit{matrice delle probabilità di transizione per colonna}\footnote{Se il \textit{retweet graph} in considerazione ha \textit{N} nodi, tale matrice ha dimensione $N \times N$ ed ogni suo elemento \textit{P[i][j]} è la probabilità di passare dal nodo \textit{j} al nodo \textit{i} in un solo passo, sapendo di essere attualmente nel nodo \textit{j}.} associata al \textit{retweet graph} considerato;
\item \textit{X\textsuperscript{*} e Y\textsuperscript{*}} rispettivamente gli insiemi dei \textit{k\textsubscript{1} e k\textsubscript{2}} nodi con \textit{in-degree} più alto delle due comunità \textit{X e Y}. Inoltre sia \textit{c\textsubscript{x}} un vettore di dimensione \textit{n} avente valore \textit{1} nelle coordinate corrispondenti ai nodi dell'insieme \textit{X\textsuperscript{*}} e \textit{0} altrove; similmente viene definito \textit{c\textsubscript{y}};
\item \textit{r\textsubscript{x}} il vettore di \textit{PageRank} personalizzato per il \textit{random walk} che parte dalla comunità \textit{X}. Sia inoltre $(1-\alpha)$ la probabilità di \textit{restart} di tale \textit{random walk} (e dunque $\alpha$ è la probabilità di continuare) e sia $\textit{e\textsubscript{x} = Uniform(X)}$ il suo vettore di \textit{restart}: ossia il \textit{random walk}, ad ogni passo, decide di ricominciare il proprio cammino con probabilità $(1-\alpha)$ e tra tutti i nodi della \textit{comunità X}, con eguale probabilità, sceglie il nodo da cui ricominciare.
\\Simili considerazioni valgono per \textit{r\textsubscript{y}}.
\end{itemize}
Bisogna ora risolvere il problema dei vertici \textit{dangling}, ossia i vertici del grafo che non hanno archi in uscita. Se un \textit{random walk} dovesse casualmente finire in uno di questi nodi esso potrebbe non uscirne, compromettendo l'esecuzione di \textit{PageRank}. Per evitare tale situazione, vengono utilizzate non una ma due \textit{matrici delle probabilità di transizione per colonna P\textsubscript{x} e P\textsubscript{y}}, usate rispettivamente dal \textit{random walk} che inizia dalla comunità \textit{X} e dal \textit{random walk} che inizia dalla comunità \textit{Y}. Se il grafo non contiene vertici \textit{dangling}, si ha banalmente \textit{P\textsubscript{x} = P\textsubscript{y} = P}; se al contrario li contenesse, le matrici \textit{P\textsubscript{x} e P\textsubscript{y}} sono definite in modo tale che le probabilità di transizione dai vertici \textit{dangling} sono uguali, rispettivamente, ai vettori di \textit{restart} \textit{e\textsubscript{x} ed e\textsubscript{y}}.
\\Il \textit{PageRank} personalizzato per i due \textit{random walks} che, rispettivamente, iniziano nella \textit{comunità X e Y} e dato da:
\\
\begin{equation}
r_x = \alpha P_xr_x + (1-\alpha)e_x
\end{equation}
\begin{equation}
r_y = \alpha P_yr_y + (1-\alpha)e_y
\end{equation}
\\
Per il calcolo dei vettori di \textit{PageRank} personalizzati (\textit{r\textsubscript{x} e r\textsubscript{y}}), quindi, bisogna imporre una situazione di \textit{stazionarietà} dei rispettivi \textit{random walks}. 
\\Possiamo finalmente definire il \textit{random-walk controversy score}:
\\
\begin{equation}
RWC(G,X,Y) = (c_x - c_y)\textsuperscript{T}(r_x - r_y)
\end{equation}
\\
Sostituendo le equazioni (3.2) e (3.3) nell'espressione (3.4) si ottiene:
\\
\begin{equation}
RWC(G,X,Y) = (1 - \alpha)(c_x - c_y)\textsuperscript{T}(M_x\textsuperscript{-1}e_x - M_y\textsuperscript{-1}e_y)
\end{equation}
\\
Dove \textit{M\textsubscript{x} = (I - $\alpha$P\textsubscript{x})} e \textit{M\textsubscript{y} = (I - $\alpha$P\textsubscript{y})}. Quest'ultima è la formula utilizzata nell'implementazione del sistema proposto. Ad ogni modo, riferendosi all'equazione (3.4) è possibile fare le seguenti osservazioni:
\begin{enumerate}
\item Innanzitutto occorre precisare che \textit{r\textsubscript{x}} è una \textit{distribuzione stazionaria di probabilità} del \textit{random walk} associato all'esecuzione di \textit{PageRank page\textsubscript{x}}: ognuno dei suoi elementi \textit{r\textsubscript{x}[i]} ($\forall \textit{i = 0,...,n-1}$) rappresenta la probabilità che il \textit{random walk} si trovi nel nodo \textit{i} all'equilibrio. Simili considerazioni valgono per \textit{r\textsubscript{y}};
\item Qualora le due comunità (\textit{echo-chambers}) \textit{X e Y} fossero molto divise tra loro (i.e. pochissimi archi diretti che le connettono), ci si aspetterebbe un \textit{r\textsubscript{x}} con valori pressoché nulli nelle coordinate corrispondenti ai nodi di \textit{Y} e non nulli altrove e, viceversa, parlando di \textit{r\textsubscript{y}}\footnote{Ricordare che, essendo \textit{distribuzioni di probabilità}, vale: $\sum_{i=0}^{n-1} r_x[i] = 1$ e $\sum_{i=0}^{n-1} r_y[i] = 1$.}. In tal caso l'espressione $(c_x - c_y)\textsuperscript{T}(r_x - r_y)$ assume il valore massimo, indice di un'elevata \textit{controversia} nella rete.
\item Qualora le due comunità fossero invece sufficientemente connesse tra loro, ci si aspetterebbe un vettore \textit{r\textsubscript{x}} con valori abbastanza uniformi su tutte le sue coordinate; la stessa considerazione varrebbe per \textit{r\textsubscript{y}}. In tal caso il grafo non presenterebbe un'elevata controversia (\textit{RWC(G,X,Y)} assume valori bassi), e questo risultato sarebbe confermato dal fatto che le due comunità sono sufficientemente esposte l'una a l'altra.
\end{enumerate}
\end{enumerate}
Per terminare, si può affermare che l'indice \textit{RWC(G,X,Y)} riesce a descrivere perfettamente il grado di controversia della discussione in atto, in funzione del livello di esposizione reciproca delle due comunità (ossia i due punti di vista opposti): qualora tale livello fosse molto basso, l'indice di controversia sarebbe molto elevato e, pertanto, la scelta più efficace per attenuarlo sarebbe quella di cercare di esporre gli utenti a visioni opposte alle proprie. 
\\Nel prossimo paragrafo saranno illustrati gli algoritmi utilizzati nel sistema proposto, i quali hanno come obiettivo proprio quello di esporre reciprocamente, \textit{nel modo più efficace possibile}, i due lati della controversia. 

\section{Definizione formale degli algoritmi per la risoluzione}
Il problema che si vorrebbe risolvere è il seguente: 
\\\\
\textit{Dato un endorsement graph G(V,E) che descrive una discussione riguardo ad un certo topic controverso t, trovare l'insieme di k archi diretti non ancora presenti nel grafo che, qualora si materializzassero, minimizzerebbero il suo RWC(G,X,Y).}
\\\\
Ovvero, formalmente:
\\
\begin{equation*}
\begin{aligned}
& \underset{E\textsubscript{k}}{\text{minimize}}
& & RWC(G(V, E \cup E\textsubscript{k}),X,Y) \\
& \text{subject to}
& & E\textsubscript{k} \subseteq V \times V \setminus E, \left|{E\textsubscript{k}}\right| = k
\end{aligned}
\end{equation*}
\\
Risolvere tale problema, così come si presenta, richiederebbe di considerare tutti le possibili combinazioni degli archi ancora non presenti nel grafo presi a gruppi di \textit{k}: queste combinazioni sono pari a \textit{O}($n^2 \choose k$), dove con \textit{n} indichiamo il numero di nodi del grafo.
\\Come è facile immaginare, un algoritmo che considera tutte queste combinazioni di archi è molto inefficiente dal punto di vista computazionale, soprattutto alla luce del fatto che gli \textit{endorsement graphs} delle reti sociali come quella di \textit{Twitter} sono costituiti da alcune migliaia di nodi e migliaia di archi.
\\Si propone, pertanto, di restringere il dominio degli archi candidati: seguendo l'approccio dell'articolo \cite{garimella:paper} è possibile considerare solo gli archi tra vertici con \textit{in-degree} alto di ciascuna \textit{echo-chamber}. La scelta di questa euristica, come osservano gli autori dell'articolo \cite{garimella:paper}, è giustificata dal fatto che la struttura degli \textit{endorsement graph} spesso mette in luce la presenza di un piccolo numero di nodi \textit{leader} (i.e. utenti popolari) ed un gran numero di nodi \textit{non leader} (i.e. utenti seguaci): i nodi \textit{leader} ricevono molti archi in ingresso (ossia hanno alto \textit{in-degree}) in quanto i loro \textit{tweet} vengono \textit{retweettati} massivamente. 



\section{Calcolo del decremento della controversia associato ad un arco}
